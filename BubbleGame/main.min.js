var rm;!function(e){e.AppLoaderEvent={LOAD_START:e.RNumber.start().toString(),LOAD_PROGRESS:e.RNumber.next.toString(),LOAD_COMPLETE:e.RNumber.next.toString()}}(rm||(rm={}));var EventCtrl=app.EventDispatcher.create(),BubbleType={Blue:1,Cyan:2,Green:3,Orange:4,Purple:5,Red:6,Yellow:7,Rainbow:8,Air:9,Ice:10,Iron:11,Stone:12,Wood:13,Dye_Blue:14,Dye_Cyan:15,Dye_Green:16,Dye_Orange:17,Dye_Purple:18,Dye_Red:19,Dye_Yellow:20,Fire:21,Bomb:22,Coin:23},BubbleManager=function(){function e(){}var t=(__define,e);t.prototype;return e.playAttackWaitSound=function(e){this.stopAttackWaitSound(),this._attackC=SoundManager.playSoundAndCache(e,0)},e.stopAttackWaitSound=function(){SoundManager.stopEffect(this._attackC),this._attackC=null},e.playAlarmSound=function(){this._alarmC||(this.stopAlarmSound(),this._alarmC=SoundManager.playSoundAndCache("alarm_mp3",0))},e.stopAlarmSound=function(){SoundManager.stopEffect(this._alarmC),this._alarmC=null},e.playHitSoundByType=function(e){switch(e){case BubbleType.Blue:case BubbleType.Green:case BubbleType.Orange:case BubbleType.Purple:case BubbleType.Rainbow:case BubbleType.Red:case BubbleType.Yellow:case BubbleType.Cyan:SoundManager.playSoundAndCache("hit_bubble_mp3");break;case BubbleType.Wood:SoundManager.playSoundAndCache("hit_wood_mp3");break;case BubbleType.Iron:case BubbleType.Ice:SoundManager.playSoundAndCache("hit_iron_mp3");break;case BubbleType.Stone:SoundManager.playSoundAndCache("hit_stone_mp3");break;case BubbleType.Dye_Blue:case BubbleType.Dye_Cyan:case BubbleType.Dye_Green:case BubbleType.Dye_Orange:case BubbleType.Dye_Purple:case BubbleType.Dye_Red:case BubbleType.Dye_Yellow:SoundManager.playSoundAndCache("dye_mp3")}},e.getDyeTypeByType=function(e){return e==BubbleType.Dye_Blue?BubbleType.Blue:e==BubbleType.Dye_Cyan?BubbleType.Cyan:e==BubbleType.Dye_Green?BubbleType.Green:e==BubbleType.Dye_Orange?BubbleType.Orange:e==BubbleType.Dye_Purple?BubbleType.Purple:e==BubbleType.Dye_Red?BubbleType.Red:e==BubbleType.Dye_Yellow?BubbleType.Yellow:0},e.isCanDye=function(e){return e==BubbleType.Blue||e==BubbleType.Green||e==BubbleType.Orange||e==BubbleType.Purple||e==BubbleType.Red||e==BubbleType.Yellow||e==BubbleType.Cyan?!0:!1},e.getScoreByType=function(e){return 100},e.changeCoin=function(e){BubbleCacheData.coin=e,ConfigManager.cacheData(),EventCtrl.emit(0)},e.changeWave=function(e){BubbleCacheData.wave=e,ConfigManager.cacheData()},e.changeFireBall=function(e){BubbleCacheData.fireBall=e,ConfigManager.cacheData()},e.AttackType=[BubbleType.Blue,BubbleType.Cyan,BubbleType.Green,BubbleType.Orange,BubbleType.Purple,BubbleType.Red,BubbleType.Yellow,BubbleType.Rainbow,BubbleType.Bomb],e.MAX_ATTACKTYPE=e.AttackType.length,e}();egret.registerClass(BubbleManager,"BubbleManager");var URLRequest=egret.URLRequest,ConfigManager=function(){function e(){}var t=(__define,e);t.prototype;return e.setup=function(){var e=egret.localStorage.getItem(this.loackStorageKey);if(e){var t=JSON.parse(e);BubbleCacheData=t}},e.cacheData=function(){egret.localStorage.setItem(this.loackStorageKey,JSON.stringify(BubbleCacheData))},e.noticeMovieClipData=function(e){return this.notice||(this.notice=new egret.MovieClipDataFactory(RES.getRes("LionAndNoticeBg_json"),RES.getRes("LionAndNoticeBg_png"))),this.notice.generateMovieClipData(e)},e.getNoticeTxt=function(e){this.notice_txt||(this.notice_txt=RES.getRes("notice_txt_json"));var t=this.notice_txt&&this.notice_txt[e];return t||rm.log("未找到的通告配置文本 id ：",e),t},e.loackStorageKey="Bubble",e}();egret.registerClass(ConfigManager,"ConfigManager");var NoticeTxt={No_Wave:"<font size='34' color='#F8DB9A'>酱～没有海浪啦，去商城买吧～</font>",No_Fire:"<font size='34' color='#F8DB9A'>火球没有啦，快去商城买吧～</font>",No_Coin:"<font size='34' color='#F8DB9A'>金币不足喽！快去打泡泡吧～</font>",Cannot_Fire:"<font size='34' color='#F8DB9A'>不可以交换火球哦！</font>"},BubbleCacheData={fireBall:10,coin:0,wave:10,level:0,levelData:{1:{target:15e3,max:0},2:{target:1e3,max:0},3:{target:1e3,max:0},4:{target:1e3,max:0},5:{target:1e3,max:0},6:{target:1e3,max:0},7:{target:1e3,max:0},8:{target:1e3,max:0},9:{target:1e3,max:0},10:{target:1e3,max:0},11:{target:1e3,max:0},12:{target:1e3,max:0},13:{target:1e3,max:0},14:{target:1e3,max:0},15:{target:1e3,max:0},16:{target:1e3,max:0},17:{target:1e3,max:0},18:{target:1e3,max:0},19:{target:1e3,max:0},20:{target:1e3,max:0},21:{target:1e3,max:0},22:{target:1e3,max:0},23:{target:1e3,max:0},24:{target:1e3,max:0},25:{target:1e3,max:0},26:{target:1e3,max:0},27:{target:1e3,max:0},28:{target:1e3,max:0},29:{target:1e3,max:0},30:{target:1e3,max:0},31:{target:1e3,max:0},32:{target:1e3,max:0},33:{target:1e3,max:0},34:{target:1e3,max:0},35:{target:1e3,max:0},36:{target:1e3,max:0},37:{target:1e3,max:0},38:{target:1e3,max:0},39:{target:1e3,max:0},40:{target:1e3,max:0},41:{target:1e3,max:0},42:{target:1e3,max:0},43:{target:1e3,max:0},44:{target:1e3,max:0},45:{target:1e3,max:0},46:{target:1e3,max:0},47:{target:1e3,max:0},48:{target:1e3,max:0},49:{target:1e3,max:0},50:{target:1e3,max:0},51:{target:1e3,max:0},52:{target:1e3,max:0},53:{target:1e3,max:0},54:{target:1e3,max:0},55:{target:1e3,max:0},56:{target:1e3,max:0},57:{target:1e3,max:0},58:{target:1e3,max:0},59:{target:1e3,max:0},60:{target:1e3,max:0},61:{target:1e3,max:0},62:{target:1e3,max:0},63:{target:1e3,max:0},64:{target:1e3,max:0},65:{target:1e3,max:0},66:{target:1e3,max:0},67:{target:1e3,max:0},68:{target:1e3,max:0},69:{target:1e3,max:0},70:{target:1e3,max:0},71:{target:1e3,max:0},72:{target:1e3,max:0},73:{target:1e3,max:0},74:{target:1e3,max:0},75:{target:1e3,max:0},76:{target:1e3,max:0},77:{target:1e3,max:0},78:{target:1e3,max:0},79:{target:1e3,max:0},80:{target:1e3,max:0}}},LevelManager=function(){function e(){}var t=(__define,e);t.prototype;return e.getLevelMapData=function(e){var t=RES.getRes("level-"+e+"_json");return t?t.layers[0]:null},e.setLevelData=function(e,t){var i=BubbleCacheData.levelData[e];i&&(i.max=Math.max(t,i.max),ConfigManager.cacheData())},e.getStarLevel=function(e,t){void 0===t&&(t=-1);var i=BubbleCacheData.levelData[e];if(!i)return 0;var n=i.max;if(t>-1&&(n=t),i.target<=n)return 3;var s=n/i.target;return s>=.7?2:s>.3?1:0},e.getMaxScore=function(e){var t=BubbleCacheData.levelData[e];return t?t.max:0},e.getTargetScore=function(e){var t=BubbleCacheData.levelData[e];return t?t.target:0},e.curLevel=-1,e}();egret.registerClass(LevelManager,"LevelManager");var ResManager=function(){function e(){}var t=(__define,e);t.prototype;return e.getBubbleImage=function(e){return"bubble-"+e+"_png"},e.tiled=[BubbleType.Blue,BubbleType.Cyan,BubbleType.Green,BubbleType.Orange,BubbleType.Purple,BubbleType.Red,BubbleType.Yellow,BubbleType.Air,BubbleType.Ice,BubbleType.Iron,BubbleType.Stone,BubbleType.Wood,BubbleType.Dye_Blue,BubbleType.Dye_Cyan,BubbleType.Dye_Green,BubbleType.Dye_Orange,BubbleType.Dye_Purple,BubbleType.Dye_Red,BubbleType.Dye_Yellow,BubbleType.Coin],e.TILED_MAX_TYPE=e.tiled.length,e}();egret.registerClass(ResManager,"ResManager");var SoundManager=function(){function e(){}var t=__define,i=e;i.prototype;return t(e,"muted",void 0,function(e){this._muted=e,this.muteAllSound(this._muted)}),e.muteAllSound=function(e){e?(this.allEffectOnOff(!1),this.bgSoundOnOff(!1)):(this.MUSIC_SOUND&&this.allEffectOnOff(!0),this.BG_SOUND&&this.bgSoundOnOff(!0))},e.playBg=function(e){void 0===e&&(e=null),e&&(this.BG_SOUND_RES!=e&&(this.stopBg(),this.BG_SOUND_RES=e),this._soundBgc||(this._soundBgc=this.playSound(this.BG_SOUND_RES,0)),!this.BG_SOUND&&this._soundBgc&&(this._soundBgc.volume=0))},e.stopBg=function(){this._soundBgc&&(this._soundBgc.stop(),this._soundBgc=null)},e.playSoundAndCache=function(e,t){void 0===t&&(t=1);var i=this.playSound(e,t);return!this.MUSIC_SOUND&&i&&(i.volume=0),i&&(this._soundChannelList.push(i),t>0&&i.addEventListener(egret.Event.SOUND_COMPLETE,this.onSoundComplete,this)),i},e.playSound=function(e,t){void 0===t&&(t=1);var i=RES.getRes(e);if(i){var n=i.play(0,t);return n.volume=this._muted?0:1,n}return null},e.onSoundComplete=function(e){var t=e.target;this.stopEffect(t)},e.allEffectOnOff=function(e){this._soundChannelList.forEach(function(t){t.volume=e?1:0},this)},e.bgSoundOnOff=function(e){this._soundBgc&&(this._soundBgc.volume=e?1:0)},e.stopEffect=function(e){if(e){e.removeEventListener(egret.Event.SOUND_COMPLETE,this.onSoundComplete,this);var t=this._soundChannelList.indexOf(e);~t&&this._soundChannelList.splice(t,1),e.stop(),e=null}},e._soundChannelList=[],e.MUSIC_SOUND=!0,e.BG_SOUND=!0,e.BG_SOUND_RES="bg_mp3",e._muted=!1,e}();egret.registerClass(SoundManager,"SoundManager");var StepAction=function(){function e(){this.t=0,this.b=0,this.c=0,this.d=0,this.result=0,this.isComplete=!1,this.tweenFun=rm.Tween.Linear,this.back=!1,this.step=1}var t=(__define,e),i=t.prototype;return i.set=function(e,t,i,n){return this.t=e,this.b=t,this.c=i,this.d=n,this.step=1,this},i.update=function(){return this.t>=0&&this.t<=this.d&&(this.t+=this.step,this.result=this.tweenFun(this.t,this.b,this.c,this.d)),this.t>=this.d&&(this.back?(this.t=this.d,this.step=-1):(this.isComplete=!0,this.isComplete&&this.thisObj&&this.callback&&this.callback.call(this.thisObj))),this.back&&(this.isComplete=this.t<=0,this.isComplete&&this.thisObj&&this.callback&&(this.step=1,this.callback.call(this.thisObj))),parseFloat(this.result.toFixed(2))},i.addCbf=function(e,t){return this.callback=e,this.thisObj=t,this},e.create=function(){return new e},i.reset=function(){this.isComplete=!0,this.t=0,this.step=1},e}();egret.registerClass(StepAction,"StepAction");var GameConfig=function(){function e(){}var t=(__define,e);t.prototype;return e.STAGE_W=568,e.STAGE_H=852,e}();egret.registerClass(GameConfig,"GameConfig");var rm;!function(e){var t=function(t){function i(){t.call(this),this._filterNoShowList=[],this._groupList={},this.addEvent()}__extends(i,t);var n=__define,s=i,o=s.prototype;return n(i,"instance",function(){return this._instance||(this._instance=new e.AppLoaderControl),this._instance}),o.route=function(t,i){if(i.data.resGroupName&&""!=i.data.resGroupName){if(e.AppLoaderControl.instance.isLoading(i.data.resGroupName))return t("正在加载资源组："+i.data.resGroupName);e.AppLoaderControl.instance.load(i.data.resGroupName,function(){t()},null,!0,i.data.loadingTitle)}else t()},o.addEvent=function(){RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this)},o.removeEvent=function(){RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this)},o.isLoaderComplete=function(e){return RES.isGroupLoaded(e)},o.isLoading=function(e){return!!this._groupList[e]},o.load=function(e,t,i,n,s){void 0===t&&(t=null),void 0===i&&(i=null),void 0===n&&(n=!0),void 0===s&&(s=""),n?this.removeFromFilterShowList(e):this.addToFilterShowList(e),t&&(this._groupList[e]={callback:t,thisObj:i}),this.onLoadGroup(e,s)},o.isHasFilterShowList=function(e){var t=this._filterNoShowList.indexOf(e);return-1!=t},o.addToFilterShowList=function(e){0==this.isHasFilterShowList(e)&&this._filterNoShowList.push(e)},o.removeFromFilterShowList=function(e){var t=this._filterNoShowList.indexOf(e);-1!=t&&this._filterNoShowList.splice(t,1)},o.onLoadGroup=function(t,i){void 0===i&&(i=""),0==this.isHasFilterShowList(t)&&this.dispatchEventWith(e.AppLoaderEvent.LOAD_START,!1,{groupName:t,showTxt:i}),RES.loadGroup(t)},o.onResourceLoadComplete=function(t){this.dispatchEventWith(e.AppLoaderEvent.LOAD_COMPLETE,!1,{groupName:t.groupName});var i=this._groupList[t.groupName];i&&(this._groupList[t.groupName]=null,i.callback.call(i.thisObj))},o.onItemLoadError=function(e){console.warn("Url:"+e.resItem.url+" has failed to load")},o.onResourceLoadError=function(e){console.warn("Group:"+e.groupName+" has failed to load"),this.onResourceLoadComplete(e)},o.onResourceProgress=function(t){this.isHasFilterShowList(t.groupName)||this.dispatchEventWith(e.AppLoaderEvent.LOAD_PROGRESS,!1,{groupName:t.groupName,itemsLoaded:t.itemsLoaded,itemsTotal:t.itemsTotal})},i}(egret.EventDispatcher);e.AppLoaderControl=t,egret.registerClass(t,"rm.AppLoaderControl")}(rm||(rm={}));var AssetAdapter=function(){function e(){}var t=(__define,e),i=t.prototype;return i.getAsset=function(e,t,i){function n(n){t.call(i,n,e)}if(RES.hasRes(e)){var s=RES.getRes(e);s?n(s):RES.getResAsync(e,n,this)}else RES.getResByUrl(e,n,this,RES.ResourceItem.TYPE_IMAGE)},e}();egret.registerClass(AssetAdapter,"AssetAdapter",["eui.IAssetAdapter"]);var MainLoader=function(){function e(e){this.isThemeLoadEnd=!1,this.isResourceLoadEnd=!1,this._loadGroupName="config",this._main=e;var t=new AssetAdapter;this._main.stage.registerImplementation("eui.IAssetAdapter",t),this._main.stage.registerImplementation("eui.IThemeAdapter",new ThemeAdapter);var i=new RES.VersionController;i.getVirtualUrl=function(e){var t=e.lastIndexOf("."),i=e.lastIndexOf("/");return i>t?e:e+"?v="+GameConfig.version},RES.registerVersionController(i),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")}var t=(__define,e),i=t.prototype;return i.onConfigComplete=function(e){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this);var t=new eui.Theme("resource/default.thm.json",this._main.stage);t.addEventListener(eui.UIEvent.COMPLETE,this.onThemeLoadComplete,this),rm.AppLoaderControl.instance.addEventListener(rm.AppLoaderEvent.LOAD_COMPLETE,this.onFirstLoadingComplete,this),rm.AppLoaderControl.instance.load("loading",null,null,!1)},i.onFirstLoadingComplete=function(){rm.AppLoaderControl.instance.removeEventListener(rm.AppLoaderEvent.LOAD_COMPLETE,this.onFirstLoadingComplete,this),rm.AppLoaderControl.instance.addEventListener(rm.AppLoaderEvent.LOAD_COMPLETE,this.onResourceLoadComplete,this),rm.AppLoaderControl.instance.load(this._loadGroupName,null,null,!1)},i.onThemeLoadComplete=function(){this.isThemeLoadEnd=!0,this.createScene()},i.onResourceLoadComplete=function(e){e.data.groupName==this._loadGroupName&&(rm.AppLoaderControl.instance.removeEventListener(rm.AppLoaderEvent.LOAD_COMPLETE,this.onResourceLoadComplete,this),this.isResourceLoadEnd=!0,this.createScene())},i.createScene=function(){this.isThemeLoadEnd&&this.isResourceLoadEnd&&this._main.startCreateScene()},e}();egret.registerClass(MainLoader,"MainLoader");var ThemeAdapter=function(){function e(){}var t=(__define,e),i=t.prototype;return i.getTheme=function(e,t,i,n){function s(e){t.call(n,e)}function o(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,o,null),i.call(n))}RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,o,null),RES.getResByUrl(e,s,this,RES.ResourceItem.TYPE_TEXT)},e}();egret.registerClass(ThemeAdapter,"ThemeAdapter",["eui.IThemeAdapter"]);var UILayer=eui.UILayer,rm;!function(e){e.uiApp=app.App.create()}(rm||(rm={}));var Main=function(e){function t(){e.apply(this,arguments)}__extends(t,e);var i=(__define,t),n=i.prototype;return n.createChildren=function(){e.prototype.createChildren.call(this),this.initLoading(),this.stage.addEventListener(egret.Event.ACTIVATE,function(e){SoundManager.muted=!1},this),this.stage.addEventListener(egret.Event.DEACTIVATE,function(e){SoundManager.muted=!0},this)},n.initLoading=function(){GameConfig.version=window.version,new MainLoader(this),egret.localStorage},n.startSetup=function(){this.setupConfig(),this.setupEngine()},n.setupConfig=function(){rm.Log.DEBUG=!0,console.log("version : ",GameConfig.version),console.log("rm version : ",rm.version),ConfigManager.setup()},n.setupEngine=function(){ui.setup(this),NoticeController.setup(),rm.uiApp.before.use(rm.AppLoaderControl.instance)["catch"](function(e){console.log(e)})},n.startCreateScene=function(){this.startSetup(),this.setupMainPanel()},n.setupMainPanel=function(){ui.bottomLayer.addChild(new eui.Image("Main_BG_jpg")),rm.uiApp.showApp(ui.START_PANEL)},t}(eui.UILayer);egret.registerClass(Main,"Main");var Tween=egret.Tween,BaseDisplayApp=function(e){function t(){e.call(this),this._parentSP=ui.uiLayer,this.isShowMask=!1,this.isClickMaskClose=!0,this.maskAlpha=.75}__extends(t,e);var i=__define,n=t,s=n.prototype;return i(s,"appInfo",function(){return this._appInfo},function(e){this._appInfo=e}),s.show=function(e){void 0===e&&(e=null),this._parentSP=e||this._parentSP,this._parentSP||(this._parentSP=ui.uiLayer),this.parent||this._parentSP.addChild(this),this.updateMaskBg()},s.hide=function(){this.removeMask(),Tween.removeTweens(this),this.parent&&this.parent.removeChild(this)},s.onHide=function(){Tween.removeTweens(this),rm.uiApp.hideApp(this._appInfo.appName)},s.updateMaskBg=function(){this.isShowMask?(t.maskList.push(this),t._maskBg||(t._maskBg=new egret.Shape,t._maskBg.touchEnabled=!0,t._maskBg.graphics.clear(),t._maskBg.graphics.beginFill(0,1),t._maskBg.graphics.drawRect(0,0,GameConfig.STAGE_W,GameConfig.STAGE_H),t._maskBg.graphics.endFill()),t._maskBg.alpha=this.maskAlpha,t._maskBg.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickMask,this),t._maskBg.parent||ui.topLayer.addChildAt(t._maskBg,0)):this.removeMask()},s.removeMask=function(){var e=t.maskList.indexOf(this);~e&&t.maskList.splice(e,1),t._maskBg&&t._maskBg.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickMask,this),0==t.maskList.length&&t._maskBg&&t._maskBg.parent&&t._maskBg.parent.removeChild(t._maskBg)},s.closeAllPanelNoOwn=function(){this.appInfo.isSpecialInCloseAll?rm.uiApp.closeAllApp():(this.appInfo.isSpecialInCloseAll=!0,rm.uiApp.closeAllApp(),this.appInfo.isSpecialInCloseAll=!1)},s.onClickMask=function(){this.isClickMaskClose&&this.onHide()},t.maskList=[],t}(eui.Component);egret.registerClass(BaseDisplayApp,"BaseDisplayApp");var BallCell=function(e){function t(){e.call(this),this._position=rm.Vector2D.create(),this.speed=rm.Vector2D.create(),this.sign=rm.Vector2D.create(),this.isOdd=!1,this.type=0}__extends(t,e);var i=__define,n=t,s=n.prototype;return t.create=function(e){var t=rm.PoolUtil.getClass("BallCell");return t.setType(e),t},s.setType=function(e){this.type=e,this.bg||(this.bg=new eui.Image,this.addChild(this.bg)),this.type==BubbleType.Fire?this.bg.anchorOffsetX=this.bg.anchorOffsetY=30.5:this.bg.anchorOffsetX=this.bg.anchorOffsetY=22.5,this.bg.source=ResManager.getBubbleImage(e)},s.dye=function(e){BubbleManager.isCanDye(this.type)&&this.setType(e)},i(s,"position",function(){return this._position.resetToValue(this.x,this.y),this._position}),s.getSign=function(){return this.sign.x+"-"+this.sign.y},s.setSign=function(e,t){this.sign.resetToValue(~~e,~~t),this.isOdd=!!((this.sign.x+1)%2)},s.right=function(){return this.sign.x+"-"+(this.sign.y+1)},s.left=function(){return this.sign.x+"-"+(this.sign.y-1)},s.leftdown=function(){var e=this.isOdd?this.sign.y-1:this.sign.y,t=this.sign.x+1;return t+"-"+e},s.leftup=function(){var e=this.isOdd?this.sign.y-1:this.sign.y,t=this.sign.x-1;return t+"-"+e},s.rightup=function(){var e=this.isOdd?this.sign.y:this.sign.y+1,t=this.sign.x-1;return t+"-"+e},s.rightdown=function(){var e=this.isOdd?this.sign.y:this.sign.y+1,t=this.sign.x+1;return t+"-"+e},s.getRoundList=function(){return[this.left(),this.right(),this.leftdown(),this.leftup(),this.rightdown(),this.rightup()]},s.updatePosition=function(){this.x+=this.speed.x,this.y+=this.speed.y},s.reset=function(){this._position.reset(),this.speed.reset(),this.sign.reset(),this.isOdd=!1,this.type=0},s.release=function(){rm.PoolUtil.release(this)},s.isType=function(e){return e==BubbleType.Rainbow?!0:this.type==BubbleType.Rainbow?!0:e==this.type},s.getScore=function(){return BubbleManager.getScoreByType(this.type)},t}(egret.Sprite);egret.registerClass(BallCell,"BallCell",["rm.IPoolUtil"]);var CoinFlyEffect=function(e){function t(){e.call(this),this.bg=new eui.Image("GameMain_Coin_png"),this.bg.x=-13,this.bg.y=-19,this.addChild(this.bg)}__extends(t,e);var i=(__define,t),n=i.prototype;return t.create=function(){var e=rm.PoolUtil.getClass("CoinFlyEffect");return e},n.fly=function(e,t,i){this.x=e.x,this.y=e.y,i&&i.addChild(this),Tween.get(this).to({x:t.x,y:t.y},1e3,egret.Ease.quintInOut).call(this.onComplete,this)},n.onComplete=function(){Tween.removeTweens(this),rm.PoolUtil.release(this),this.parent&&this.parent.removeChild(this)},n.reset=function(){},n.release=function(){rm.PoolUtil.release(this)},t}(egret.Sprite);egret.registerClass(CoinFlyEffect,"CoinFlyEffect",["rm.IPoolUtil"]);var HelpPanel=function(e){function t(){e.call(this)}__extends(t,e);var i=(__define,t),n=i.prototype;return n.init=function(){this.skinName="HelpPanelSkin"},n.addEvent=function(){this.backBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},n.removeEvent=function(){this.backBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},n.refresh=function(e){},n.dispose=function(){},n.show=function(t){e.prototype.show.call(this,t)},n.hide=function(){e.prototype.hide.call(this)},n.onClick=function(e){switch(e.currentTarget){case this.backBtn:rm.uiApp.showApp(ui.START_PANEL),this.onHide()}},t}(BaseDisplayApp);egret.registerClass(HelpPanel,"HelpPanel",["app.IApp"]);var LevelInfoPanel=function(e){function t(){e.call(this),this._curPost=1,this._curLevel=1}__extends(t,e);var i=(__define,t),n=i.prototype;return n.init=function(){this.skinName="LevelInfoPanelSkin",this.isClickMaskClose=!0,this.isShowMask=!0,this._list=[this.starImg1,this.starImg2,this.starImg3]},n.addEvent=function(){this.playBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.closeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},n.removeEvent=function(){this.playBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.closeBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},n.refresh=function(e){this._curPost=e.post,this._curLevel=e.level;var t=10*this._curPost+this._curLevel+1;this.levelLab.text="关卡 "+t;var i=LevelManager.getLevelMapData(t);this.playBtn.enabled=!!i;var n=LevelManager.getStarLevel(t);this._list.forEach(function(e,t){e.visible=n>t}),this.maxLab.text=LevelManager.getMaxScore(t).toString(),this.targetLab.text="得分"+LevelManager.getTargetScore(t).toString()},n.dispose=function(){},n.show=function(t){e.prototype.show.call(this,ui.topLayer),this.showEffect()},n.hide=function(){e.prototype.hide.call(this)},n.onClick=function(e){switch(e.currentTarget){case this.playBtn:rm.uiApp.showApp(ui.MAIN_PANEL,{post:this._curPost,level:this._curLevel});break;case this.closeBtn:this.onHide()}},n.showEffect=function(){var e=this;this.x=GameConfig.STAGE_W/2,this.y=GameConfig.STAGE_H/2,this.anchorOffsetX=this.width/2,this.anchorOffsetY=this.height/2,this.scaleX=this.scaleY=.3,this.enabled=!1,Tween.get(this).to({scaleX:1,scaleY:1},200).call(function(){e.enabled=!0},this)},t}(BaseDisplayApp);egret.registerClass(LevelInfoPanel,"LevelInfoPanel",["app.IApp"]);var LevelPanel=function(e){function t(){e.call(this),this._postBtns=[],this._curPost=0,this._curLevel=0}__extends(t,e);var i=(__define,t),n=i.prototype;return n.init=function(){this.skinName="LevelPanelSkin",this._postBtns=[this.levelBtn1,this.levelBtn2,this.levelBtn3,this.levelBtn4,this.levelBtn5,this.levelBtn6,this.levelBtn7,this.levelBtn8,this.levelBtn9,this.levelBtn10]},n.addEvent=function(){this.levelBtn1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.levelBtn2.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.levelBtn3.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.levelBtn4.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.levelBtn5.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.levelBtn6.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.levelBtn7.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.levelBtn8.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.levelBtn9.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.levelBtn10.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.backBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.arrowImg.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.nextArrowImg.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.addEventListener(egret.Event.ENTER_FRAME,this.onef,this)},n.removeEvent=function(){this.levelBtn1.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.levelBtn2.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.levelBtn3.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.levelBtn4.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.levelBtn5.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.levelBtn6.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.levelBtn7.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.levelBtn8.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.levelBtn9.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.levelBtn10.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.backBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.arrowImg.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.nextArrowImg.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.removeEventListener(egret.Event.ENTER_FRAME,this.onef,this)},n.refresh=function(e){this.coinLab.text=BubbleCacheData.coin.toString()},n.dispose=function(){},n.show=function(t){e.prototype.show.call(this,t),this.onChangePostState()},n.hide=function(){e.prototype.hide.call(this),Tween.removeTweens(this.lightImg)},n.onClick=function(e){switch(e.currentTarget){case this.levelBtn1:rm.uiApp.showApp(ui.LEVEL_INFO_PANEL,{post:this._curPost,level:0});break;case this.levelBtn2:rm.uiApp.showApp(ui.LEVEL_INFO_PANEL,{post:this._curPost,level:1});break;case this.levelBtn3:rm.uiApp.showApp(ui.LEVEL_INFO_PANEL,{post:this._curPost,level:2});break;case this.levelBtn4:rm.uiApp.showApp(ui.LEVEL_INFO_PANEL,{post:this._curPost,level:3});break;case this.levelBtn5:rm.uiApp.showApp(ui.LEVEL_INFO_PANEL,{post:this._curPost,level:4});break;case this.levelBtn6:rm.uiApp.showApp(ui.LEVEL_INFO_PANEL,{post:this._curPost,level:5});break;case this.levelBtn7:rm.uiApp.showApp(ui.LEVEL_INFO_PANEL,{post:this._curPost,level:6});break;case this.levelBtn8:rm.uiApp.showApp(ui.LEVEL_INFO_PANEL,{post:this._curPost,level:7});break;case this.levelBtn9:rm.uiApp.showApp(ui.LEVEL_INFO_PANEL,{post:this._curPost,level:8});break;case this.levelBtn10:rm.uiApp.showApp(ui.LEVEL_INFO_PANEL,{post:this._curPost,level:9});break;case this.backBtn:rm.uiApp.showApp(ui.START_PANEL),this.onHide();break;case this.arrowImg:SoundManager.playSoundAndCache("click_mp3"),this.prePageState();break;case this.nextArrowImg:SoundManager.playSoundAndCache("click_mp3"),this.nextPageState()}},n.onChangePostState=function(){this._curPost=~~(BubbleCacheData.level/10),this._curLevel=~~(BubbleCacheData.level%10),this.invalidateState()},n.prePageState=function(){this._curPost=Math.max(0,this._curPost-1),this.isShowCurLevelPage(this._curPost),this.invalidateState()},n.nextPageState=function(){this._curPost=Math.min(7,this._curPost+1),this.isShowCurLevelPage(this._curPost),this.invalidateState()},n.isShowCurLevelPage=function(e){var t=~~(BubbleCacheData.level/10);t==e?(this._curPost=t,this._curLevel=~~(BubbleCacheData.level%10)):e>t?this._curLevel=-1:this._curLevel=10},n.getCurrentState=function(){return"level"+(this._curPost+1)},n.commitProperties=function(){e.prototype.commitProperties.call(this);for(var t,i=this._curLevel,n=0;10>n;n++)this._postBtns[n].enabled=i>=n,i==n&&(t=this._postBtns[n]);this.headImg.visible=this.lightImg.visible=!!t,t&&(this.headImg.x=this.lightImg.x=t.x,this.headImg.y=this.lightImg.y=t.y),this.arrowImg.visible=this._curPost>0,this.nextArrowImg.visible=this._curPost<7},n.onef=function(e){this.lightImg&&this.lightImg.visible&&(this.lightImg.scaleX+=.01,this.lightImg.scaleY+=.01,this.lightImg.scaleX>1.5&&(this.lightImg.scaleX=1),this.lightImg.scaleY>1.5&&(this.lightImg.scaleY=1))},t}(BaseDisplayApp);egret.registerClass(LevelPanel,"LevelPanel",["app.IApp"]);var MainPanel=function(e){function t(){e.call(this),this.TOP_POS=65,this.GAP=45,this.HALF_GAP=22.5,this._point=rm.Vector2D.create(284,749),this._to=rm.Vector2D.create(284,749),this._bubbleMap={},this._curType=0,this._nextType=0,this._combo=0,this._tween=StepAction.create(),this._isCanCheck=!1,this._isPause=!1,this._curPost=1,this._curLevel=1,this._sumScores=0,this._coinTarget=new egret.Point(158,44)}__extends(t,e);var i=(__define,t),n=i.prototype;return n.init=function(){this.skinName="MainPanelSkin",this.aimImg.alpha=0,this.topImg.y=this.scene.y-this.topImg.height,this._tween.isComplete=!0},n.addEvent=function(){this.sceneGroup.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickScene,this),this.addEventListener(egret.Event.ENTER_FRAME,this.onef,this),this.nextBubbleImg.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.fireImg.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.waveImg.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.pauseBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),rm.uiApp.eventproxy.on(ui.uievent.restart,this.onRestart,this),rm.uiApp.eventproxy.on(ui.uievent.resume,this.onResume,this),EventCtrl.on(0,this.updateToolCount,this)},n.removeEvent=function(){this.sceneGroup.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickScene,this),this.removeEventListener(egret.Event.ENTER_FRAME,this.onef,this),this.nextBubbleImg.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.fireImg.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.waveImg.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.pauseBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),EventCtrl.off(0,this.updateToolCount,this)},n.refresh=function(e){this._curPost=e.post,this._curLevel=e.level,LevelManager.curLevel=10*this._curPost+this._curLevel,this.levelLab.text=""+(LevelManager.curLevel+1),SoundManager.playSoundAndCache("readyGo_mp3"),TextEffect.create().setType(TextEffectType.Ready).setTo(GameConfig.STAGE_W/2-150,GameConfig.STAGE_H/2).addTo(this).play(),TextEffect.create().setType(TextEffectType.Go).setTo(GameConfig.STAGE_W/2+50,GameConfig.STAGE_H/2).addTo(this).play();var t=Math.min(this._curPost+1,6);this.bgImg.source=RES.getRes("GameMain_BG_"+t+"_jpg"),this.resetScene()},n.dispose=function(){},n.show=function(t){e.prototype.show.call(this,t),this.closeAllPanelNoOwn()},n.updateToolCount=function(){this.waveLab.text=BubbleCacheData.wave.toString(),this.fireLab.text=BubbleCacheData.fireBall.toString(),this.coinLab.text=BubbleCacheData.coin.toString()},n.autoHitBubble=function(){this._to.resetToValue(~~rm.getRandom(1,GameConfig.STAGE_W),~~rm.getRandom(1,GameConfig.STAGE_H)),this.rotatePaotong()},n.hide=function(){e.prototype.hide.call(this),this.clearScene(),LevelManager.curLevel=-1},n.onClick=function(e){switch(e.currentTarget){case this.nextBubbleImg:SoundManager.playSoundAndCache("click_mp3"),this.replaceBall();break;case this.fireImg:SoundManager.playSoundAndCache("click_mp3"),this.showFireBall();break;case this.waveImg:SoundManager.playSoundAndCache("click_mp3"),this.useWave();break;case this.pauseBtn:this._isPause=!0,rm.uiApp.showApp(ui.PAUSE_PANEL)}},n.useWave=function(){BubbleCacheData.wave>=1?(BubbleManager.changeWave(BubbleCacheData.wave-1),this.updateScenePosition(!0,50),SoundManager.playSoundAndCache("quick_move_mp3"),this.updateToolCount()):NoticeController.showNotice(NoticeTxt.No_Wave)
},n.onClickScene=function(e){this._isPause||(this._to.resetToValue(e.stageX,e.stageY),this.rotatePaotong())},n.rotatePaotong=function(){var e=this._to.sub(this._point).getAngle();e>-170&&-10>e||(e=-10),e+=90,this.paotongGroup.rotation=e,this.attack()},n.initBall=function(){for(var e=LevelManager.curLevel+1,t=LevelManager.getLevelMapData(e),i=t.height,n=t.width,s=1;i>=s;s++)for(var o=s%2?0:this.HALF_GAP,a=0;n>a;a++){var r=t.data[(s-1)*n+a]-1;if(r>=0&&r<ResManager.TILED_MAX_TYPE){var h=BallCell.create(ResManager.tiled[r]);h.x=~~(o+this.GAP*a),h.y=~~((s-1)*this.GAP),h.setSign(s-1,a),this._bubbleMap[h.getSign()]=h,this.scene.addChild(h)}}this.updateScenePosition(!0),this._isCanCheck=!1},n.updateScenePosition=function(e,t){if(void 0===e&&(e=!1),void 0===t&&(t=100),this._tween.isComplete){this._isCanCheck||(this._isCanCheck=!0);var i=0;for(var n in this._bubbleMap){var s=this._bubbleMap[n];s.sign.x>i&&(i=s.sign.x)}var o=this.scene.y+45*i,a=225+this.TOP_POS;e?this._tween.set(0,this.scene.y,a-o,t).isComplete=!1:a>o&&(this._tween.set(0,this.scene.y,a-o,10).isComplete=!1)}},n.clearScene=function(){this.scene.y=this.TOP_POS,this.topImg.y=this.scene.y-this.topImg.height,this._bubble=null,this.scene.removeChildren();for(var e in this._bubbleMap){var t=this._bubbleMap[e];t.release(),delete this._bubbleMap[e]}this._bubble=null,this._curType=0,this._nextType=0,this._combo=0,this._isCanCheck=!1,this._isPause=!1,this._tween.isComplete=!0,this._sumScores=0,this.scoreLab.text="0",BubbleManager.stopAttackWaitSound(),BubbleManager.stopAlarmSound()},n.resetScene=function(){BubbleManager.stopAlarmSound(),this.clearScene(),this.initBall(),this.randomNextBall(),this.showNextBall(),this.updateToolCount(),this.targetLab.text="得分"+LevelManager.getTargetScore(LevelManager.curLevel+1)},n.randomNextBall=function(){var e=~~rm.getRandom(0,BubbleManager.MAX_ATTACKTYPE),t=BubbleManager.AttackType[e];this.nextBubbleImg.source=ResManager.getBubbleImage(t),this._nextType=t},n.showNextBall=function(){this.setCurType(this._nextType),this.randomNextBall()},n.showFireBall=function(){this._curType!=BubbleType.Fire&&(BubbleCacheData.fireBall>=1?this.setCurType(BubbleType.Fire):NoticeController.showNotice(NoticeTxt.No_Fire))},n.setCurType=function(e){e==BubbleType.Fire?BubbleManager.playAttackWaitSound("fire_burning_mp3"):e==BubbleType.Bomb&&BubbleManager.playAttackWaitSound("fuse_burning_mp3"),this.curBubbleImg.source=ResManager.getBubbleImage(e),this._curType=e},n.attack=function(){if(!this._bubble){BubbleManager.stopAttackWaitSound(),this._curType==BubbleType.Fire?(SoundManager.playSoundAndCache("fireball_shoot_mp3"),BubbleManager.changeFireBall(BubbleCacheData.fireBall-1),this.updateToolCount()):this._curType==BubbleType.Bomb?SoundManager.playSoundAndCache("bomb_shoot_mp3"):SoundManager.playSoundAndCache("shoot_mp3"),Tween.get(this.aimImg).to({alpha:1},200).to({alpha:0},200),this._bubble=BallCell.create(this._curType);var e=this.paotongGroup.localToGlobal(40,-30);this.scene.globalToLocal(e.x,e.y,e),this._bubble.x=e.x,this._bubble.y=e.y,this.scene.addChild(this._bubble),this.showNextBall();var t=this.paotongGroup.rotation+90;this._bubble.speed.x=~~(-Math.cos(rm.angle2radian(t))*this.HALF_GAP),this._bubble.speed.y=~~(-Math.sin(rm.angle2radian(t))*this.HALF_GAP)}},n.onef=function(e){this._isPause||(this._tween.isComplete?this.scene.y+=.05:this.scene.y=this._tween.update(),this.topImg.y=this.scene.y-this.topImg.height,this._bubble&&((this._bubble.x>=400||this._bubble.x<=0)&&(this._bubble.speed.x*=-1,SoundManager.playSoundAndCache("hit_wall_mp3")),this._bubble.updatePosition(),this.checkAndStop()),this._isCanCheck&&this.checkGameOver(),this.updateScenePosition())},n.checkAndStop=function(){var e={target:null,distance:this.GAP,result:{}};for(var t in this._bubbleMap){var i=this._bubbleMap[t],n=this._bubble.position.distance(i.position);if(n<=e.distance){if(i.type==BubbleType.Air||i.type==BubbleType.Coin){e.result[t]=i;continue}e.target=i,e.distance=n}}this.breakBubble(e.result);var s=e.target;if(s){BubbleManager.playHitSoundByType(s.type);var o=this._bubble.position.clone().sub(s.position).getAngle(),a=s.position.clone(),r=s.sign.clone(),h=s.isOdd;o>-30&&30>=o?(a.x+=this.GAP,r.y+=1):o>30&&90>=o?(a.x+=this.HALF_GAP,a.y+=this.GAP,r.x+=1,r.y+=h?0:1):o>90&&150>=o?(a.x-=this.HALF_GAP,a.y+=this.GAP,r.x+=1,r.y+=h?-1:0):o>150&&180>=o?(a.x-=this.GAP,r.y+=-1):o>=-180&&-150>o?(a.x-=this.GAP,r.y+=-1):-30>=o&&o>-90?(a.x+=this.HALF_GAP,a.y-=this.GAP,r.x+=-1,r.y+=h?0:1):-90>=o&&o>=-150&&(a.x-=this.HALF_GAP,a.y-=this.GAP,r.x+=-1,r.y+=h?-1:0),this._bubble.x=a.x,this._bubble.y=a.y,this._bubble.setSign(r.x,r.y),this._bubble.speed.reset(),this.pushBallCellMap()&&(this.dyeRoundBubble(s,this._bubble.getSign()),this.checkAndClearBallCell(this._bubble)),this._bubble=null,this.dropBall()}else if(this._bubble.y>0&&this._bubble.y<=this.HALF_GAP){var l=~~(this._bubble.x/this.GAP);l+=this._bubble.x%this.GAP>=this.HALF_GAP?1:0,this._bubble.y=0,this._bubble.x=l*this.GAP,this._bubble.setSign(0,l),this._bubble.speed.reset(),this.pushBallCellMap()&&this.checkAndClearBallCell(this._bubble),this._bubble=null,this.dropBall()}},n.dyeRoundBubble=function(e,t){var i=BubbleManager.getDyeTypeByType(e.type);i&&(e.setType(i),e.getRoundList().forEach(function(e){e!=t&&this._bubbleMap[e]&&this._bubbleMap[e].dye(i)},this))},n.pushBallCellMap=function(){var e=this._bubble.getSign();return this._bubbleMap[e]?(TextEffect.create().setType(TextEffectType.Blocked).setTo(this._bubble.x,this._bubble.y).addTo(this.scene).play(),this._bubble.parent&&this._bubble.parent.removeChild(this._bubble),this._bubble.release(),!1):(this._bubbleMap[e]=this._bubble,!0)},n.breakBubble=function(e){var t=100,i=function(i){var s=e[i];if(s.type==BubbleType.Air)s.parent&&s.parent.removeChild(s),s.release(),SoundManager.playSoundAndCache("hit_air_mp3");else if(s.type==BubbleType.Fire)s.parent&&s.parent.removeChild(s),s.release(),SoundManager.playSoundAndCache("fireball_explode_mp3");else if(s.type==BubbleType.Coin){var o=s.localToGlobal(0,0);CoinFlyEffect.create().fly(o,n._coinTarget,n),BubbleManager.changeCoin(BubbleCacheData.coin+1),n.updateToolCount(),s.parent&&s.parent.removeChild(s),s.release(),SoundManager.playSoundAndCache("hit_coin_mp3")}else s.type==BubbleType.Bomb?(s.parent&&s.parent.removeChild(s),s.release(),SoundManager.playSoundAndCache("bomb_explode_mp3")):Tween.get(s).wait(t).to({alpha:.2},100).to({alpha:1},100).call(function(){s.parent&&s.parent.removeChild(s),s.release(),SoundManager.playSoundAndCache("bubble_burst_mp3")});n.addScore(s.getScore()),delete n._bubbleMap[i],t-=20},n=this;for(var s in e)i(s)},n.checkAndClearBallCell=function(e){var t={};if(e.type==BubbleType.Fire)return e.getRoundList().forEach(function(e){var i=this._bubbleMap[e];i&&(t[e]=i,i.getRoundList().forEach(function(e){this._bubbleMap[e]&&(t[e]=this._bubbleMap[e])},this))},this),t[e.getSign()]=e,void this.breakBubble(t);if(e.type==BubbleType.Bomb)return e.getRoundList().forEach(function(e){var i=this._bubbleMap[e];i&&(t[e]=i)},this),t[e.getSign()]=e,void this.breakBubble(t);var i=this.checkBallCell(t,e);this.combo(i,e),i>=3?(this.scene.y-=i,this.breakBubble(t)):(this.tweenCrowdBall(e,5,50),e.getRoundList().forEach(function(e){this.tweenCrowdBall(this._bubbleMap[e],2.5,50)},this))},n.tweenCrowdBall=function(e,t,i){if(e){var n=t/1.414,s=this._bubbleMap[e.left()];s&&Tween.get(s).to({x:s.x-t},i).to({x:s.x,y:s.y},i),s=this._bubbleMap[e.right()],s&&Tween.get(s).to({x:s.x+t},i).to({x:s.x,y:s.y},i),s=this._bubbleMap[e.leftup()],s&&Tween.get(s).to({x:s.x-n,y:s.y-n},i).to({x:s.x,y:s.y},i),s=this._bubbleMap[e.leftdown()],s&&Tween.get(s).to({x:s.x-n,y:s.y+n},i).to({x:s.x,y:s.y},i),s=this._bubbleMap[e.rightup()],s&&Tween.get(s).to({x:s.x+n,y:s.y-n},i).to({x:s.x,y:s.y},i),s=this._bubbleMap[e.rightdown()],s&&Tween.get(s).to({x:s.x+n,y:s.y+n},i).to({x:s.x,y:s.y},i)}},n.checkBallCell=function(e,t){var i=t.type,n=0;if(i==BubbleType.Rainbow){var s={},o={count:0,result:{}};s[BubbleType.Blue]=o,o.count=this.checkBallCellByType(o.result,BubbleType.Blue,t),o={count:0,result:{}},s[BubbleType.Green]=o,o.count=this.checkBallCellByType(o.result,BubbleType.Green,t),o={count:0,result:{}},s[BubbleType.Cyan]=o,o.count=this.checkBallCellByType(o.result,BubbleType.Cyan,t),o={count:0,result:{}},s[BubbleType.Orange]=o,o.count=this.checkBallCellByType(o.result,BubbleType.Orange,t),o={count:0,result:{}},s[BubbleType.Purple]=o,o.count=this.checkBallCellByType(o.result,BubbleType.Purple,t),o={count:0,result:{}},s[BubbleType.Red]=o,o.count=this.checkBallCellByType(o.result,BubbleType.Red,t),o={count:0,result:{}},s[BubbleType.Yellow]=o,o.count=this.checkBallCellByType(o.result,BubbleType.Yellow,t);for(var a in s){var r=s[a];if(r.count>=3)for(var h in r.result)e[h]||(e[h]=r.result[h],n++)}}else n=this.checkBallCellByType(e,i,t);return n},n.checkBallCellByType=function(e,t,i){e[i.getSign()]=i;var n={};return this.returnCheckBallCell(n,e,t,i,1)},n.returnCheckBallCell=function(e,t,i,n,s){void 0===s&&(s=0);var o=n.getRoundList();return e[n.getSign()]=n,o.forEach(function(n){var o=this._bubbleMap[n];if(o&&o.isType(i)){var a=o.getSign();e[a]||(t[a]=o,s++,s=this.returnCheckBallCell(e,t,i,o,s))}},this),s},n.dropBall=function(){var e=[];for(var t in this._bubbleMap){var i=this._bubbleMap[t];0==i.sign.x&&e.push(t)}var n={},s=100,o={x:0,y:0,count:0};this.checkSignDrop(n,e);var a=function(e){if(!n[e]){var t=r._bubbleMap[e];if(o.count++,o.x=t.x,o.y=t.y,t.type==BubbleType.Coin){var i=t.localToGlobal(0,0);CoinFlyEffect.create().fly(i,r._coinTarget,r),BubbleManager.changeCoin(BubbleCacheData.coin+1),SoundManager.playSoundAndCache("hit_coin_mp3")}delete r._bubbleMap[e],r.addScore(t.getScore()),Tween.get(t).wait(s).to({alpha:.2},100).to({alpha:1},100).call(function(){t.parent&&t.parent.removeChild(t),t.release(),SoundManager.playSoundAndCache("bubble_burst_mp3")}),s-=20}},r=this;for(var t in this._bubbleMap)a(t);n=null,o.count>15?(SoundManager.playSoundAndCache("excellent_mp3"),TextEffect.create().setType(TextEffectType.Nice).setTo(o.x,o.y).addTo(this.scene).play()):o.count>13?(SoundManager.playSoundAndCache("cool_mp3"),TextEffect.create().setType(TextEffectType.Nice).setTo(o.x,o.y).addTo(this.scene).play()):o.count>8?(SoundManager.playSoundAndCache("nice_mp3"),TextEffect.create().setType(TextEffectType.Nice).setTo(o.x,o.y).addTo(this.scene).play()):o.count>3&&(SoundManager.playSoundAndCache("good_mp3"),TextEffect.create().setType(TextEffectType.Good).setTo(o.x,o.y).addTo(this.scene).play())},n.checkSignDrop=function(e,t){t.forEach(function(t){var i=this._bubbleMap[t];i&&!e[t]&&(e[t]=i,this.checkSignDrop(e,i.getRoundList()))},this)},n.checkGameOver=function(){var e={row:0,ball:null,count:0};for(var t in this._bubbleMap){e.count++;var i=this._bubbleMap[t];i.sign.x>e.row&&(e.row=i.sign.x,e.ball=i)}if(e.ball){var n=e.ball.localToGlobal(0,this.GAP);this.globalToLocal(n.x,n.y,n);var s=n.y-this.fireLine.y;s>0?this.onGameOver(!1):s>-(2*this.GAP)?BubbleManager.playAlarmSound():BubbleManager.stopAlarmSound()}else 0==e.count&&this.onGameOver(!0)},n.replaceBall=function(){if(this._curType==BubbleType.Fire)return NoticeController.showNotice(NoticeTxt.Cannot_Fire);var e=this._curType;this.setCurType(this._nextType),this._nextType=e,this.nextBubbleImg.source=ResManager.getBubbleImage(this._nextType)},n.combo=function(e,t){e>=3?(this._combo++,this._combo>=2&&(SoundManager.playSoundAndCache("combo_mp3"),TextEffect.create().setType(TextEffectType.Combo,this._combo).setTo(t.x,t.y).addTo(this.scene).play(),this.addScore(100*this._combo))):this._combo=0},n.onRestart=function(){this.resetScene()},n.onResume=function(){this._isPause=!1},n.onGameOver=function(e){BubbleManager.stopAlarmSound(),BubbleManager.stopAttackWaitSound(),this._isPause=!0,rm.uiApp.showApp(ui.WINORLOSE_PANEL,{result:e,score:this._sumScores})},n.addScore=function(e){this._sumScores+=e,this.scoreLab.text=this._sumScores.toString()},t}(BaseDisplayApp);egret.registerClass(MainPanel,"MainPanel",["app.IApp"]);var PausePanel=function(e){function t(){e.call(this)}__extends(t,e);var i=(__define,t),n=i.prototype;return n.init=function(){this.skinName="PausePanelSkin";var e=rm.getPointsInCircle(6,0,500,1,1.5,0,new egret.Point(GameConfig.STAGE_W>>1,GameConfig.STAGE_H>>1));this.restartBtnT=TweenEffect.create(this.restartBtn,e[5],new egret.Point(234,194)),this.backBtnT=TweenEffect.create(this.backBtn,e[4],new egret.Point(130,286)),this.soundBtnT=TweenEffect.create(this.soundBtn,e[3],new egret.Point(137,393)),this.musicBtnT=TweenEffect.create(this.musicBtn,e[2],new egret.Point(225,471)),this.shopBtnT=TweenEffect.create(this.shopBtn,e[1],new egret.Point(337,387)),this.resumeBtnT=TweenEffect.create(this.resumeBtn,e[0],new egret.Point(362,266)),this.backBtnT.resetPos(),this.shopBtnT.resetPos(),this.restartBtnT.resetPos(),this.resumeBtnT.resetPos(),this.musicBtnT.resetPos(),this.soundBtnT.resetPos()},n.addEvent=function(){this.restartBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.resumeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.shopBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.backBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.musicBtn.addEventListener(egret.Event.CHANGE,this.onBgSoundChange,this),this.soundBtn.addEventListener(egret.Event.CHANGE,this.onSoundChange,this)},n.removeEvent=function(){this.restartBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.resumeBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.shopBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.backBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.musicBtn.removeEventListener(egret.Event.CHANGE,this.onBgSoundChange,this),this.soundBtn.removeEventListener(egret.Event.CHANGE,this.onSoundChange,this)},n.refresh=function(e){},n.dispose=function(){},n.show=function(t){e.prototype.show.call(this,t),this.soundBtn.selected=!SoundManager.MUSIC_SOUND,this.musicBtn.selected=!SoundManager.BG_SOUND,this.backBtnT.play(),this.shopBtnT.play(),this.restartBtnT.play(),this.resumeBtnT.play(),this.musicBtnT.play(),this.soundBtnT.play()},n.hide=function(){e.prototype.hide.call(this),this.backBtnT.resetPos(),this.shopBtnT.resetPos(),this.restartBtnT.resetPos(),this.resumeBtnT.resetPos(),this.musicBtnT.resetPos(),this.soundBtnT.resetPos()},n.onClick=function(e){switch(e.currentTarget){case this.restartBtn:this.onHide(),rm.uiApp.eventproxy.emit(ui.uievent.restart);break;case this.resumeBtn:this.onHide(),rm.uiApp.eventproxy.emit(ui.uievent.resume);break;case this.shopBtn:rm.uiApp.showApp(ui.SHOP_PANEL);break;case this.backBtn:rm.uiApp.showApp(ui.LEVEL_PANEL),rm.uiApp.hideApp(ui.MAIN_PANEL),this.onHide()}},n.onSoundChange=function(e){SoundManager.MUSIC_SOUND=!this.soundBtn.selected,SoundManager.allEffectOnOff(SoundManager.MUSIC_SOUND)},n.onBgSoundChange=function(e){SoundManager.bgSoundOnOff(!this.musicBtn.selected),SoundManager.BG_SOUND=!this.musicBtn.selected},t}(BaseDisplayApp);egret.registerClass(PausePanel,"PausePanel",["app.IApp"]);var ShopPanel=function(e){function t(){e.call(this)}__extends(t,e);var i=(__define,t),n=i.prototype;return n.init=function(){this.skinName="ShopPanelSkin"},n.addEvent=function(){this.oneBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.twoBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.threeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.fourBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.backBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),EventCtrl.on(0,this.refresh,this)},n.removeEvent=function(){this.oneBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.twoBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.threeBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.fourBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.backBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),EventCtrl.off(0,this.refresh,this)},n.refresh=function(e){this.coinLab.text=BubbleCacheData.coin+"",this.waveLab.text=BubbleCacheData.wave+"",this.fireLab.text=BubbleCacheData.fireBall+""},n.dispose=function(){},n.show=function(t){e.prototype.show.call(this,t)},n.hide=function(){e.prototype.hide.call(this)},n.onClick=function(e){switch(e.currentTarget){case this.oneBtn:BubbleCacheData.coin>=50?(BubbleManager.changeFireBall(BubbleCacheData.fireBall+3),BubbleManager.changeCoin(BubbleCacheData.coin-50)):NoticeController.showNotice(NoticeTxt.No_Coin);break;case this.twoBtn:BubbleCacheData.coin>=150?(BubbleManager.changeFireBall(BubbleCacheData.fireBall+10),BubbleManager.changeCoin(BubbleCacheData.coin-150)):NoticeController.showNotice(NoticeTxt.No_Coin);break;case this.threeBtn:BubbleCacheData.coin>=50?(BubbleManager.changeWave(BubbleCacheData.wave+3),BubbleManager.changeCoin(BubbleCacheData.coin-50)):NoticeController.showNotice(NoticeTxt.No_Coin);break;case this.fourBtn:BubbleCacheData.coin>=150?(BubbleManager.changeWave(BubbleCacheData.wave+10),BubbleManager.changeCoin(BubbleCacheData.coin-150)):NoticeController.showNotice(NoticeTxt.No_Coin);break;case this.backBtn:this.onHide()}},t}(BaseDisplayApp);egret.registerClass(ShopPanel,"ShopPanel",["app.IApp"]);var StartPanel=function(e){function t(){e.call(this)}__extends(t,e);var i=(__define,t),n=i.prototype;return n.init=function(){var e=rm.getPointsInCircle(5,0,500,1,1.5,0,new egret.Point(GameConfig.STAGE_W>>1,GameConfig.STAGE_H>>1));this.skinName="StartPanelSkin",this.startBtnT=TweenEffect.create(this.startBtn,e[4],new egret.Point(184,397)),this.helpBtnT=TweenEffect.create(this.helpBtn,e[3],new egret.Point(34,480)),this.shopBtnT=TweenEffect.create(this.shopBtn,e[2],new egret.Point(150,604)),this.musicBtnT=TweenEffect.create(this.musicBtn,e[1],new egret.Point(322,592)),this.soundBtnT=TweenEffect.create(this.soundBtn,e[0],new egret.Point(404,459)),this.helpBtnT.resetPos(),this.shopBtnT.resetPos(),this.startBtnT.resetPos(),this.musicBtnT.resetPos(),this.soundBtnT.resetPos()},n.addEvent=function(){this.helpBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.shopBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.startBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.musicBtn.addEventListener(egret.Event.CHANGE,this.onBgSoundChange,this),this.soundBtn.addEventListener(egret.Event.CHANGE,this.onSoundChange,this)},n.removeEvent=function(){this.helpBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.shopBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.startBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.musicBtn.removeEventListener(egret.Event.CHANGE,this.onBgSoundChange,this),this.soundBtn.removeEventListener(egret.Event.CHANGE,this.onSoundChange,this)},n.refresh=function(e){},n.dispose=function(){},n.show=function(t){e.prototype.show.call(this,t),SoundManager.playBg("bg_mp3"),this.soundBtn.selected=!SoundManager.MUSIC_SOUND,this.musicBtn.selected=!SoundManager.BG_SOUND,this.helpBtnT.play(),this.shopBtnT.play(),this.startBtnT.play(),this.musicBtnT.play(),this.soundBtnT.play()},n.hide=function(){e.prototype.hide.call(this),this.helpBtnT.back(),this.shopBtnT.back(),this.startBtnT.back(),this.musicBtnT.back(),this.soundBtnT.back()},n.onClick=function(e){switch(e.currentTarget){case this.helpBtn:rm.uiApp.showApp(ui.HELP_PANEL),this.onHide();break;case this.shopBtn:rm.uiApp.showApp(ui.SHOP_PANEL);break;case this.startBtn:rm.uiApp.showApp(ui.LEVEL_PANEL),this.onHide()}},n.onSoundChange=function(e){SoundManager.MUSIC_SOUND=!this.soundBtn.selected,SoundManager.allEffectOnOff(SoundManager.MUSIC_SOUND)},n.onBgSoundChange=function(e){SoundManager.bgSoundOnOff(!this.musicBtn.selected),SoundManager.BG_SOUND=!this.musicBtn.selected},t}(BaseDisplayApp);egret.registerClass(StartPanel,"StartPanel",["app.IApp"]);var TextEffectType;!function(e){e[e.Combo=0]="Combo",e[e.Nice=1]="Nice",e[e.Good=2]="Good",e[e.Excellent=3]="Excellent",e[e.Ready=4]="Ready",e[e.Great=5]="Great",e[e.Go=6]="Go",e[e.Fail=7]="Fail",e[e.Success=8]="Success",e[e.Blocked=9]="Blocked"}(TextEffectType||(TextEffectType={}));var TextEffect=function(e){function t(){e.call(this)}__extends(t,e);var i=(__define,t),n=i.prototype;return t.create=function(){var e=rm.PoolUtil.getClass("TextEffect");return e.layout=new eui.HorizontalLayout,e},n.setType=function(e,t){return void 0===t&&(t=0),e==TextEffectType.Combo?(this.setImg1("Txt_Combo_png"),this.setImgText(t.toString())):e==TextEffectType.Good?this.setImg1("Txt_Good_png"):e==TextEffectType.Nice?this.setImg1("Txt_Nice_png"):e==TextEffectType.Great?this.setImg1("Txt_Great_png"):e==TextEffectType.Success?this.setImg1("Txt_TargetDone_png"):e==TextEffectType.Fail?this.setImg1("Txt_Fail_png"):e==TextEffectType.Go?this.setImg1("Txt_Go_png"):e==TextEffectType.Ready?this.setImg1("Txt_Ready_png"):e==TextEffectType.Excellent?this.setImg1("Txt_Excellent_png"):e==TextEffectType.Blocked&&this.setImg1("Txt_Blocked_png"),this.anchorOffsetX=this.width/2,this.anchorOffsetY=this.height/2,this},n.setImg1=function(e){this.img1||(this.img1=new eui.Image),this.img1.source=e,this.addChild(this.img1)},n.setImgText=function(e){this.imgText||(this.imgText=new eui.BitmapLabel,this.imgText.font="hallBet_fnt",this.imgText.verticalCenter=0,this.imgText.scaleX=this.imgText.scaleY=.5),this.imgText.text=e,this.addChild(this.imgText)},n.release=function(){Tween.removeTweens(this),rm.PoolUtil.release(this),this.parent&&this.parent.removeChild(this)},n.reset=function(){this.imgText&&this.imgText.parent&&this.removeChild(this.imgText),this.img1&&this.img1.parent&&this.removeChild(this.img1)},n.addTo=function(e){return e&&e.addChild(this),this},n.setTo=function(e,t){return this.x=e,this.y=t,this},n.play=function(e){void 0===e&&(e=1e3),Tween.get(this).to({y:this.y-50},100).wait(e).call(function(){this.release()},this)},t}(eui.Group);egret.registerClass(TextEffect,"TextEffect",["rm.IPoolUtil"]);var TweenEffect=function(){function e(e,t,i){this.target=e,this.pos=t,this.tpos=i}var t=(__define,e),i=t.prototype;return e.create=function(t,i,n){return new e(t,i,n)},i.play=function(){Tween.removeTweens(this.target),Tween.get(this.target).to({x:this.tpos.x,y:this.tpos.y},400)},i.back=function(){Tween.removeTweens(this.target),Tween.get(this.target).to({x:this.pos.x,y:this.pos.y},400)},i.resetPos=function(){this.target.x=this.pos.x,this.target.y=this.pos.y},i.resetTPos=function(){this.target.x=this.tpos.x,this.target.y=this.tpos.y},e}();egret.registerClass(TweenEffect,"TweenEffect");var WinOrLosePanel=function(e){function t(){e.call(this)}__extends(t,e);var i=(__define,t),n=i.prototype;return n.init=function(){this.skinName="WinOrLosePanelSkin",this._list=[this.starBtn1,this.starBtn2,this.starBtn3];var e=rm.getPointsInCircle(3,0,500,1,1.5,0,new egret.Point(GameConfig.STAGE_W>>1,GameConfig.STAGE_H>>1));this.restartBtnT=TweenEffect.create(this.restartBtn,e[2],new egret.Point(225,395)),this.backBtnT=TweenEffect.create(this.backBtn,e[1],new egret.Point(126,506)),this.nextBtnT=TweenEffect.create(this.nextBtn,e[0],new egret.Point(360,490)),this.shopBtnT=TweenEffect.create(this.shopBtn,e[0],new egret.Point(360,490)),this.backBtnT.resetPos(),this.shopBtnT.resetPos(),this.restartBtnT.resetPos(),this.nextBtnT.resetPos()},n.addEvent=function(){this.nextBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.restartBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.backBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.shopBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},n.removeEvent=function(){this.nextBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.restartBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.backBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.shopBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},n.refresh=function(e){var t=e.result,i=LevelManager.getStarLevel(LevelManager.curLevel+1,e.score);this._list.forEach(function(e,t){e.enabled=i>t}),this.scoreLab.text=e.score+"",this.maxLab.text=LevelManager.getMaxScore(LevelManager.curLevel+1).toString(),t&&(BubbleCacheData.level=Math.max(BubbleCacheData.level,LevelManager.curLevel+1),LevelManager.setLevelData(LevelManager.curLevel+1,e.score)),this.targetImg.visible=t&&3==i,this.nextBtn.visible=t,this.shopBtn.visible=!t,this.logoImg.source=t?"Txt_Title_Complete_png":"Txt_Title_GameOver_png",SoundManager.playSoundAndCache(t?"win_mp3":"lose_mp3"),this.backBtnT.play(),this.shopBtnT.play(),this.restartBtnT.play(),this.nextBtnT.play()},n.dispose=function(){},n.show=function(t){e.prototype.show.call(this,t)},n.hide=function(){e.prototype.hide.call(this),this.backBtnT.resetPos(),this.shopBtnT.resetPos(),this.restartBtnT.resetPos(),this.nextBtnT.resetPos()},n.onClick=function(e){switch(e.currentTarget){case this.nextBtn:this.onHide();var t=LevelManager.curLevel+1,i=~~(t/10),n=~~(t%10);rm.uiApp.refreshApp(ui.MAIN_PANEL,{post:i,level:n});break;case this.restartBtn:this.onHide(),rm.uiApp.eventproxy.emit(ui.uievent.restart);break;case this.backBtn:rm.uiApp.showApp(ui.LEVEL_PANEL),rm.uiApp.hideApp(ui.MAIN_PANEL),this.onHide();break;case this.shopBtn:rm.uiApp.showApp(ui.SHOP_PANEL)}},t}(BaseDisplayApp);egret.registerClass(WinOrLosePanel,"WinOrLosePanel",["app.IApp"]);var BottomNoticeUI=function(){function e(e,t){this._noticeList=[],this._position=new egret.Point(e,t)}var t=(__define,e),i=t.prototype;return i.execute=function(e,t){if(!t)return egret.log("error: TopNoticeUI Parent Is Null!");var i=this.getTextField(e);t.addChild(i),this.startAction(i)},i.getTextField=function(t){var i;return this._noticeList.length>=e.MAX_VALUE?(i=this._noticeList.shift(),Tween.removeTweens(i),i.parent&&i.parent.removeChild(i),i.clear(),this._noticeList.push(i)):(i=new NoticeTxtUI,this._noticeList.push(i)),i.show(t),i},i.startAction=function(t){Tween.removeTweens(t),this.updatePosition(),t.alpha=1,Tween.get(t).wait(e.TIME).to({alpha:.2},1e3).call(this.complete,this,[t])},i.complete=function(e){e.parent&&e.parent.removeChild(e),e.clear()},i.interrupt=function(){for(var e=this._noticeList.length;e-->0;){var t=this._noticeList[e];Tween.removeTweens(t),t.parent&&t.parent.removeChild(t),t.clear()}},i.updatePosition=function(){for(var t=this._noticeList.length,i=this._position.y;t-->0;)this._noticeList[t].y=i,this._noticeList[t].x=this._position.x,i-=e.GAP_VALUE},e.MAX_VALUE=3,e.GAP_VALUE=74,e.TIME=500,e}();egret.registerClass(BottomNoticeUI,"BottomNoticeUI");var NoticeController=function(){function e(){}var t=(__define,e);t.prototype;return e.setup=function(){this._topNoticeUI=new TopNoticeUI,this._bottomNoticeUI=new BottomNoticeUI(GameConfig.STAGE_W/2,GameConfig.STAGE_H-80)},e.showNotice=function(e,t){return void 0===t&&(t=1),e?(rm.log(e),void(1==t?this._bottomNoticeUI.execute(e,ui.noticeLayer):0==t?this._topNoticeUI.execute(e,ui.noticeLayer):egret.log("error: NoticeController Not Has Type !"))):rm.log("error: 通告文本非法！")},e.showNoticeArgs=function(e,t,i){if(void 0===i&&(i=1),!e)return rm.log("error: 通告文本非法！");var n=rm.getReplaceText(e,t);this.showNotice(n,i)},e.showNoticeEx=function(e,t){void 0===t&&(t=1),this.showNotice(ConfigManager.getNoticeTxt(e),t)},e.showNoticeArgsEx=function(e,t,i){void 0===i&&(i=1),this.showNoticeArgs(ConfigManager.getNoticeTxt(e),t,i)},e.forceClearTopNotice=function(){this._topNoticeUI.interrupt()},e.forceClearBottomNotice=function(){this._bottomNoticeUI.interrupt()},e}();egret.registerClass(NoticeController,"NoticeController");var NoticeTxtUI=function(e){function t(){e.call(this),this._bgImg=new egret.Bitmap(RES.getRes("tips_notice_png")),this._bgImg.scale9Grid=new egret.Rectangle(263,9,179,54),this.addChild(this._bgImg),this._bgImg.anchorOffsetY=15,this._textField=new egret.TextField,this._textField.fontFamily="黑体",this.addChild(this._textField)}__extends(t,e);var i=(__define,t),n=i.prototype;return n.show=function(e){this._textField.textFlow=rm.htmlParser.parser(e);var t=this._textField.textWidth;this._bgImg.width=t+200,this._bgImg.anchorOffsetX=(t+200)/2,this._textField.anchorOffsetX=t/2},n.clear=function(){this._textField.textFlow=null},t}(egret.DisplayObjectContainer);egret.registerClass(NoticeTxtUI,"NoticeTxtUI");var TopNoticeUI=function(){function e(){this._topNoticeLish=[],this._isShow=!1,this._speed=.16,this._notice=new egret.DisplayObjectContainer,this._rect=new eui.Rect(844,94),this._notice.y=150,this._rect.anchorOffsetX=this._rect.width>>1,this._rect.anchorOffsetY=this._rect.height>>1,this._rect.x=GameConfig.STAGE_W>>1}var t=(__define,e),i=t.prototype;return i.execute=function(e,t){return t?(this._topNoticeLish.push(e),this._bgmc||(this._notice.addChild(this._bgmc),this._bgmc.x=GameConfig.STAGE_W>>1),!this._notice.parent&&this._bgmc.gotoAndPlay(0,1),t.addChild(this._notice),void(this._isShow||this.onTopNoticeComplete())):egret.log("error: TopNoticeUI Parent Is Null!")},i.onTopNoticeComplete=function(){if(Tween.removeTweens(this._bgmc),this._bgmc.scaleX=1,0==this._topNoticeLish.length)return void Tween.get(this._bgmc).to({scaleX:0},500).call(this.interrupt,this);var e=GameConfig.STAGE_W>>1;this.startAction(this._topNoticeLish.shift(),e+422,e-422)},i.getNoticeItem=function(e){return this._noticeItem||(this._noticeItem=new TopNoticeUIItem,this._notice.addChild(this._rect),this._notice.addChild(this._noticeItem),this._noticeItem.mask=this._rect),this._noticeItem.show(e),this._noticeItem},i.startAction=function(e,t,i){this._isShow=!0;var n=this.getNoticeItem(e);Tween.removeTweens(n),n.x=t,i-=n.getWidth();var s=Math.abs(t-i),o=s/this._speed;Tween.get(n).to({x:i},o).call(this.onTopNoticeComplete,this)},i.interrupt=function(){this._isShow=!1,this._notice.parent&&this._notice.parent.removeChild(this._notice),this._noticeItem&&this._noticeItem.clear(),this._noticeItem&&Tween.removeTweens(this._noticeItem),this._bgmc&&this._bgmc.stop()},e}();egret.registerClass(TopNoticeUI,"TopNoticeUI");var TopNoticeUIItem=function(e){function t(){e.call(this),this._textField=new egret.TextField,this._textField.fontFamily="黑体",this.addChild(this._textField)}__extends(t,e);var i=(__define,t),n=i.prototype;return n.show=function(e){this._textField.textFlow=rm.htmlParser.parser(e),this._textField.anchorOffsetY=this._textField.textHeight>>1},n.getWidth=function(){return this._textField.textWidth},n.clear=function(){this._textField.textFlow=null},t}(egret.DisplayObjectContainer);egret.registerClass(TopNoticeUIItem,"TopNoticeUIItem");var Sound=egret.Sound,UIController=function(){function e(){}var t=(__define,e);t.prototype;return e.setup=function(e){e&&(this._main=e,ui.topLayer=new egret.DisplayObjectContainer,ui.bottomLayer=new egret.DisplayObjectContainer,ui.uiLayer=new egret.DisplayObjectContainer,ui.noticeLayer=new egret.DisplayObjectContainer,ui.loadingLayer=new UILoading,e.addChild(ui.bottomLayer),e.addChild(ui.uiLayer),e.addChild(ui.noticeLayer),e.addChild(ui.topLayer),e.addChild(ui.loadingLayer),this._main.stage.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this,!1,Number.POSITIVE_INFINITY))},e.onClick=function(e){var t=egret.getQualifiedClassName(e.target);switch(t){case"eui.Button":case"eui.ToggleSwitch":SoundManager.playSoundAndCache("click_mp3")}},e}();egret.registerClass(UIController,"UIController");var ui;!function(e){function t(t){e.loadingLayer.visible=t}function i(e){UIController.setup(e)}e.MAIN_PANEL=rm.uiApp.registerAppInfo("MainPanel",!1,{resGroupName:"main"}),e.START_PANEL=rm.uiApp.registerAppInfo("StartPanel",!1,{resGroupName:"start"}),e.HELP_PANEL=rm.uiApp.registerAppInfo("HelpPanel",!1,{resGroupName:"start"}),e.SHOP_PANEL=rm.uiApp.registerAppInfo("ShopPanel",!1,{resGroupName:"start"}),e.LEVEL_PANEL=rm.uiApp.registerAppInfo("LevelPanel",!1,{resGroupName:"level"}),e.LEVEL_INFO_PANEL=rm.uiApp.registerAppInfo("LevelInfoPanel",!1,{resGroupName:"level"}),e.PAUSE_PANEL=rm.uiApp.registerAppInfo("PausePanel",!1,{resGroupName:"level"}),e.WINORLOSE_PANEL=rm.uiApp.registerAppInfo("WinOrLosePanel",!1,{resGroupName:"level"}),e.uievent={resume:"resume",restart:"restart"},e.disableLoading=t,e.setup=i
}(ui||(ui={}));var UILoading=function(e){function t(){e.call(this),this.loadingGroupName="",this.isLoading=!1,this.skinName="UILoadingSkin",this.top=this.bottom=this.left=this.right=0,this.addEvent()}__extends(t,e);var i=(__define,t),n=i.prototype;return n.addEvent=function(){rm.AppLoaderControl.instance.addEventListener(rm.AppLoaderEvent.LOAD_START,this.onStart,this),rm.AppLoaderControl.instance.addEventListener(rm.AppLoaderEvent.LOAD_PROGRESS,this.onProgress,this),rm.AppLoaderControl.instance.addEventListener(rm.AppLoaderEvent.LOAD_COMPLETE,this.onComplete,this)},n.onStart=function(e){var t=e.data.groupName;this.loadingGroupName!=t&&(this.loadingGroupName=t,this.isLoading||this.addChild(this.loadingSP),this.textField.text="0%",this.isLoading=!0)},n.onProgress=function(e){var t=e.data.groupName;this.loadingGroupName==t&&this.setProgress(e.data.itemsLoaded,e.data.itemsTotal)},n.onComplete=function(e){var t=e.data.groupName;this.loadingGroupName==t&&(this.isLoading=!1,this.loadingSP.parent&&this.loadingSP.parent.removeChild(this.loadingSP))},n.setProgress=function(e,t){this.textField.text=Math.ceil(e/t*100)+"%"},t}(eui.Component);egret.registerClass(UILoading,"UILoading");var rm;!function(e){function t(t,i,n,s,o){void 0===n&&(n=12),void 0===s&&(s=!1),void 0===o&&(o=!1);var a="<font size='"+n+"' color='"+e.toColorString(i)+"'>"+t+"</font>";return s&&(a=e.getBoldText(a)),o&&(a=e.getUnLineText(a)),a}function i(e){return"<b>"+e+"</b>"}function n(e){return"<u>"+e+"</u>"}function s(e,t){var i=t.concat(),n=e.replace(/{@}/g,function(){return i.shift()});return n}var o=function(){function e(){}var t=(__define,e);t.prototype;return e}();e.HtmlTextUtil=o,egret.registerClass(o,"rm.HtmlTextUtil"),e.htmlParser=new egret.HtmlTextParser,e.getTextColor=t,e.getBoldText=i,e.getUnLineText=n,e.getReplaceText=s}(rm||(rm={}));